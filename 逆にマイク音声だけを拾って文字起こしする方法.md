# 逆にマイク音声だけを拾って文字起こしする手順（Windows）
PC内音声のループバックではなく、外部マイクだけを文字起こししたい場合の設定メモ。`.env` と Windows 側のルーティングをマイク専用に戻します。

## 1. ゴール
- Transcriber はマイク入力のみを取得し、PC再生音は拾わない。
- Speechmatics への送信は 16 kHz / モノラルのまま安定動作。
- Web UI/ログは従来通り利用可能。

## 2. `.env` の最小変更
以下を設定（デバイス番号は `--list-devices` の WASAPI マイクを採用。例では #19）。
```ini
AUDIO_CAPTURE_MODE=microphone
AUDIO_DEVICE_INDEX=19
AUDIO_DEVICE_SAMPLE_RATE=16000
AUDIO_SAMPLE_RATE=16000
AUDIO_CHANNELS=1
AUDIO_CHUNK_DURATION_SECONDS=0.5

# ループバック前提の自動設定を無効化
AUDIO_AUTO_SETUP_LOOPBACK=false

# ループバック名は空にする（行削除でも可）
# AUDIO_WINDOWS_LOOPBACK_DEVICE=
```
`AUDIO_DEVICE_INDEX` は `python -m transcriber.cli --list-devices` で確認したマイク番号を入れる。WASAPI (例: `19: マイク (2.0 Camera) | ... | Windows WASAPI`) が推奨。

## 3. Windows 側のルーティング
1. `Win + R` → `mmsys.cpl` を開く。
2. 録音タブで外部マイクを既定に設定（`マイク (2.0 Camera)` など）。  
3. 録音タブで `CABLE Output` のプロパティを開き、「このデバイスを聴く」をオフ。ループバック経路を断つ。
4. 「設定 > サウンド > 音量ミキサー」で Chrome/Discord などの入出力デバイスを「既定」に戻す（VB-CABLE 固定を解除）。
5. マイクの詳細設定を 16-bit / 16000 Hz / Mono に揃える。ドライバ側のリサンプルを避けるため。

## 4. 動作確認
1. `python -m transcriber.cli --diagnose-audio`  
   - `キャプチャモード: microphone`  
   - `設定済みデバイス: #19 マイク (2.0 Camera)` のように表示されること。
2. 録音タブのレベルメーターが自分の声だけに反応し、PC再生音では揺れないことを目視確認。
3. `easy_setup.cmd` → `Environment ready. Start transcription now? [Y/n]: Y`  
   - ログに `Starting audio stream on マイク (2.0 Camera) (device index 19)` と出て、`Final:` が流れればOK。

## 5. よくある混入パスと防ぎ方
- `CABLE Output` の「このデバイスを聴く」がオンのまま → オフにする。
- 音量ミキサーで Chrome/Discord の出力が `CABLE Input` に固定 → 既定に戻す。
- 別のソフトが VB-CABLE を既定録音にしている → 録音タブでマイクを既定に再設定。

## 6. ループバック構成へ戻すときのメモ
- `.env` を `AUDIO_CAPTURE_MODE=loopback`、`AUDIO_DEVICE_INDEX` を VB-CABLE の番号へ戻す。
- `AUDIO_AUTO_SETUP_LOOPBACK=true`、`AUDIO_WINDOWS_LOOPBACK_DEVICE=CABLE Output (VB-Audio Virtual Cable)` に復帰。
- 録音タブで `CABLE Output` の「このデバイスを聴く」をオン、音量ミキサーで Chrome/Discord の出力を `CABLE Input` に固定。

以上でマイクのみの文字起こし構成に切り替えられます。***
